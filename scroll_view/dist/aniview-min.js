!function($,factory){if("function"==typeof define)define.amd?define(["jQuery"],function(jQuery){return factory(jQuery||$)}):define(function(require,exports,module){var jq=require("jQuery")||$;module.exports=factory(jq)});else{if("object"!=typeof module||!module.exports)return factory($),$;module.exports=factory($)}}(jQuery,function($){"use strict";function viewPortSize(){if(_container&&_container[0].document!==window.document){var offset=_container.offset();return{top:_container.scrollTop()+offset.top,left:_container.scrollLeft()+offset.left}}return{top:_container.scrollTop(),left:_container[0].pageXOffset}}function atTop(){return viewPortSize().top<=10}function atBottom(){var docHeight,height,port=viewPortSize();return _container&&_container[0].document!==window.document?(docHeight=window.document.documentElement.offsetHeight,height=window.document.documentElement.clientHeight):(docHeight=_container[0].offsetHeight+_container[0].scrollTop,height=_container[0].clientHeight),port.top+height>=docHeight-10}function _nearest(viewBottom,eleTop){for(var tmp,tmpTop,cur=Math.abs(eleTop-viewBottom),diff=0,flag=!0,i=0;i<_elements.length;i++)if(_isEntryView(_elements[i],!0)&&(tmp=$(_elements[i].ele),tmpTop=_getOffset(tmp[0]).top+tmp.height()*_elements[i].viewPercent,diff=Math.abs(tmpTop-viewBottom),cur>diff)){flag=!1;break}return flag}function _getOffset(eleDom){for(var offsetTop=eleDom.offsetTop,offsetLeft=eleDom.offsetLeft;eleDom.offsetParent;)eleDom=eleDom.offsetParent,isNaN(eleDom.offsetTop)||(offsetTop+=eleDom.offsetTop),isNaN(eleDom.offsetLeft)||(offsetLeft+=eleDom.offsetLeft);return{top:offsetTop,left:offsetLeft}}function _isEntryView(eleObj,withoutNearest){var ele=$(eleObj.ele),viewPercent=eleObj.viewPercent,_viewer=viewPortSize(),viewTop=_viewer.top,viewLeft=_viewer.left,viewBottom=viewTop+_container.height(),viewRight=viewLeft+_container.width(),eleOffset=_getOffset(ele[0]),eleTop=eleOffset.top+ele.height()*viewPercent,eleLeft=eleOffset.left+ele.width()*viewPercent,eleBottom=eleOffset.top+(1-viewPercent)*ele.height(),eleRight=eleOffset.left+(1-viewPercent)*ele.width(),result=eleTop<=viewBottom&&eleBottom>=viewTop&&eleLeft>=viewLeft&&eleRight<=viewRight;return!withoutNearest&&result&&nearest&&(result=atTop()?_nearest(viewTop,eleTop):(atBottom(),_nearest(viewBottom,eleTop))),result}function _shouldReset(eleObj){return!_isEntryView(eleObj)&&eleObj.blocked&&eleObj.active}function _shouldActive(eleObj){return _isEntryView(eleObj)&&!eleObj.blocked&&!eleObj.active}function _animate(){$.each(_elements,function(i,eleObj){eleObj&&(_shouldActive(eleObj)?_aniView.animate(eleObj,!0):_loop&&_shouldReset(eleObj)&&_aniView.animate(eleObj,!1))})}function AniView(config){var options=$.extend({},defaults,config);this.options=options,_container=options.container||$(window),_loop=options.loop,nearest=void 0!==options.nearest&&options.nearest,this.init(),_container.on("scroll",function(){_animate()})}var _aniView=void 0,_elements=[],_container=void 0,nearest=!1,_loop=!1,defaults={container:"",delay:200,aniClass:".ani",loop:!1,viewPercent:.2,animateCallback:function(){},resetCallback:function(){}};AniView.prototype.init=function(){var that=this,ops=that.options,aniClass=ops.aniClass;$(aniClass).each(function(i,ele){_elements.push({ele:ele,viewPercent:ops.viewPercent,active:!1,blocked:!1,animation:$(ele).data("viewAnimation"),callback:{starter:void 0,timer:void 0}})})},AniView.prototype.animate=function(eleObj,shouldActive){var that=this,ops=that.options,diff=0;if(shouldActive){if(eleObj.blocked)return!1;eleObj.active=!0,eleObj.blocked=!0,$(eleObj.ele).addClass("active"),eleObj.animation&&$(eleObj.ele).addClass(eleObj.animation),"function"==typeof ops.animateCallback&&ops.animateCallback(eleObj)}else{if(!eleObj.blocked)return!1;eleObj.active=!1,eleObj.blocked=!1,eleObj.callback.timer?(diff=(new Date).getTime()-eleObj.callback.starter,clearTimeout(eleObj.callback.timer)):eleObj.callback.starter=(new Date).getTime(),eleObj.callback.timer=setTimeout(function(){$(eleObj.ele).removeClass("active"),eleObj.animation&&$(eleObj.ele).removeClass(eleObj.animation),"function"==typeof ops.resetCallback&&ops.resetCallback(eleObj),eleObj.callback.timer=void 0},Math.abs(ops.delay-diff))}},$.extend({aniView:function(config){_aniView||(_aniView=new AniView(config),_animate())}})});